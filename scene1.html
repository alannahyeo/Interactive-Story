<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scene 1</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Syne+Mono&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="scene1.css?v=14" />
</head>
<body class="fade-in">
  <div class="center-box">
    <div class="scene-wrapper">
      <!-- Scene 1 -->
      <div class="scene-content" id="scene1">
        <h1 class="top-text">
          <span class="investigation-text">Investigation 1:</span>
          <span class="social-media-text">Eli's Social Media Feed</span>
        </h1>
        <div class="content-split">
          <div class="left-text">
            <div id="typewriter-text"></div>
            <p id="continuePrompt" class="continue-prompt">Press To Continue</p>
          </div>
          <div class="right-empty">
            <img src="eli-missing-poster-final.png?v=1" alt="Eli's Poster" class="right-image"
              onerror="this.style.display='none'; console.error('Image not found')" />
          </div>
        </div>
      </div>

      <!-- Scene 2 -->
      <div id="scene2" class="scene-content" style="display:none; opacity:0;">
        <h1 class="final-title">Decipher The Suspicious Posts</h1>
        <p class="final-subtitle">Click on all the posts that seem suspicious</p>
        <div class="instagram-grid" id="postGrid">
          <img src="post1.png" class="insta-post" data-id="1">
          <img src="post2.png" class="insta-post" data-id="2">
          <img src="post3.png" class="insta-post" data-id="3">
          <img src="post4.png" class="insta-post" data-id="4">
          <img src="post5.png" class="insta-post" data-id="5">
          <img src="post6.png" class="insta-post" data-id="6">
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- Typewriter Audio -->
  <audio id="fxAudio" src="typewriter-audio.mp3" preload="auto" loop></audio>
  <audio id="clickSound" src="click.mp3" preload="auto"></audio>

  <!-- Script -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const fxAudio = document.getElementById('fxAudio');
      const textElement = document.getElementById('typewriter-text');
      const continuePrompt = document.getElementById('continuePrompt');

      const texts = [
        "Eli has mysteriously gone missing after a series of suspicious posts were shared on his social media feed...",
        "Authorities are scrambling to trace his digital footprint, but clues are vanishing as quickly as they appear.",
        "You've been tasked to dig deeper - to uncover the truth behind his disappearance and decode the feed."
      ];

      let currentIndex = 0;

      function typeWriterText(text, callback) {
        textElement.innerHTML = '';

        const paragraph = document.createElement('p');
        paragraph.style.margin = '0 0 1rem 0';
        textElement.appendChild(paragraph);

        const cursor = document.createElement('span');
        cursor.className = 'typewriter-cursor';
        paragraph.appendChild(cursor);

        let i = 0;
        const speed = 30;

        try {
          fxAudio.currentTime = 0;
          fxAudio.play().catch(e => console.warn("Audio play failed (user interaction required):", e));
        } catch (err) {
          console.warn("Audio error:", err);
        }

        function typeNextChar() {
          if (i < text.length) {
            const charSpan = document.createElement('span');
            charSpan.textContent = text.charAt(i);
            paragraph.insertBefore(charSpan, cursor);
            i++;
            setTimeout(typeNextChar, speed);
          } else {
            fxAudio.pause();
            cursor.remove();
            if (callback) callback();
          }
        }

        typeNextChar();
      }

      function showNextText() {
        if (currentIndex < texts.length) {
          continuePrompt.classList.remove('show');
          typeWriterText(texts[currentIndex], () => {
            continuePrompt.classList.add('show');
          });
          currentIndex++;
        } else {
          const scene1 = document.getElementById('scene1');
          const scene2 = document.getElementById('scene2');
          continuePrompt.classList.remove('show');
          scene1.classList.add('fade-out');

          setTimeout(() => {
            scene1.style.display = 'none';
            scene2.style.display = 'flex';
            scene2.style.opacity = '1';

            // Add click listeners for posts
            document.querySelectorAll('.insta-post').forEach(post => {
              post.addEventListener('click', () => {
                const clickSound = document.getElementById('clickSound');
                clickSound.currentTime = 0;
                clickSound.play().catch(e => console.warn("Click sound error:", e));
                
                const postId = post.getAttribute('data-id');
                const suspiciousIds = ['5', '4', '6'];
                const isSuspicious = suspiciousIds.includes(postId);

                post.classList.toggle('suspicious');
                showToast(isSuspicious
                  ? "✅ Good eye! This post is suspicious."
                  : "❌ Hmm... this one doesn't seem suspicious."
                );
              });
            });
          }, 1000);
        }
      }

      function showToast(message) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.add('toast-show');
        setTimeout(() => {
          toast.classList.remove('toast-show');
        }, 2000);
      }

      // Initialize first message
      continuePrompt.addEventListener('click', showNextText);
      showNextText();

      // Shuffle posts once
      const postGrid = document.getElementById("postGrid");
      if (postGrid) {
        const posts = Array.from(postGrid.children);
        for (let i = posts.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [posts[i], posts[j]] = [posts[j], posts[i]];
        }
        posts.forEach(post => postGrid.appendChild(post));
      }
    });
  </script>
</body>
</html>
