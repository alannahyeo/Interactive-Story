<!DOCTYPE html>
<html lang="en">

<style>
  body {
    background-image: url('homepage-background.png');
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;
    margin: 0;
    font-family: 'Syne Mono', monospace, sans-serif;
    color: white;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
  }

  .center-box {
    opacity: 0;
    animation: fadeInOnly 1s ease forwards;
  }

  @keyframes fadeInOnly {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .scene-wrapper {
    width: 100%;
    position: relative;
  }

  .scene-content {
    width: 100%;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    box-sizing: border-box;
  }

  .top-text {
    font-size: 36px;
    color: red;
    margin-top: 0;
    text-align: center;
    text-shadow: 0 0 10px red, 0 0 20px red;
  }

  .social-media-text {
    font-size: 36px;
    display: block;
    margin-top: 10px;
  }

  .content-split {
    display: flex;
    justify-content: space-between;
    gap: 2rem;
    margin-top: 2rem;
    width: 100%;
    box-sizing: border-box;
  }

  .left-text {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    gap: 1rem;
  }

  #typewriter-text {
    white-space: pre-wrap;
    word-break: break-word;
    line-height: 1.8;
    width: 100%;
    font-size: 1.1rem;
    min-height: 10em;
    max-height: 10em;
    overflow-y: auto;
  }

  .typewriter-cursor {
    display: inline-block;
    width: 2px;
    background: red;
    height: 1em;
    animation: blink-caret 0.75s step-end infinite;
  }

  @keyframes blink-caret {
    from, to { opacity: 0; }
    50% { opacity: 1; }
  }

  .continue-prompt {
    font-family: 'Syne Mono', monospace;
    font-size: 14px;
    color: red;
    text-shadow: 0 0 5px red, 0 0 10px red;
    cursor: pointer;
    user-select: none;
    visibility: hidden;
    opacity: 0;
    transition: opacity 0.3s ease;
    margin-top: 1rem;
    margin-bottom: 1rem;
  }

  .continue-prompt.show {
    visibility: visible;
    opacity: 1;
    animation: glowText 1.5s ease-in-out infinite alternate;
  }

  @keyframes glowText {
    from {
      text-shadow: 0 0 5px red;
      opacity: 0.6;
    }
    to {
      text-shadow: 0 0 20px red;
      opacity: 1;
    }
  }

  .right-empty {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: flex-start;
  }

  .right-image {
    max-width: 100%;
    max-height: 250px;
    object-fit: contain;
    border-radius: 10px;
    box-shadow: 0 0 6px rgba(255, 0, 0, 0.4), 0 0 12px rgba(255, 0, 0, 0.3);
    margin-top: -10px;
  }

  .fade-out {
    opacity: 0;
    transition: opacity 1s ease-in-out;
    pointer-events: none;
  }

  #scene2 {
    opacity: 0;
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    transition: opacity 2s ease-in-out;
    width: 100%;
    height: 100%;
    padding: 0;
    margin: 0;
    box-sizing: border-box;
  }

  .final-title {
    font-size: 28px;
    color: red;
    font-family: 'Syne Mono', monospace;
    text-align: center;
    text-shadow: 0 0 10px red;
    margin: 20px 0 0 0;
    opacity: 0;
    animation: fadeInOnly 2s ease-in-out forwards;
  }

  .final-subtitle {
    font-size: 18px;
    color: white;
    font-family: 'Syne Mono', monospace;
    margin-top: 12px;
    text-align: center;
    opacity: 0;
    animation: fadeInOnly 2s ease-in-out 1s forwards;
  }

  .instagram-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    padding: 10px;
    width: 100%;
    justify-items: center;
    margin-bottom: 20px;
  }

  .insta-post {
    width: 100%;
    max-width: 180px;
    height: auto;
    border-radius: 10px;
    cursor: pointer;
    transition: transform 0.2s ease;
  }

  .insta-post:hover {
    transform: scale(1.05);
    box-shadow: 0 0 15px red;
  }

  .suspicious {
    outline: 3px solid red;
    box-shadow: 0 0 20px red;
  }

  @media (max-width: 600px) {
    .instagram-grid {
      grid-template-columns: repeat(2, 1fr);
    }
    .insta-post {
      max-width: 140px;
    }
  }

  .toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: black;
    color: white;
    border: 2px solid red;
    padding: 12px 20px;
    border-radius: 8px;
    box-shadow: 0 0 15px red;
    font-family: 'Syne Mono', monospace;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.5s ease;
  }

  .toast-show {
    opacity: 1;
  }

  .continue-button {
    position: fixed;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    padding: 14px 36px;
    font-size: 18px;
    font-family: 'Syne Mono', monospace;
    background-color: black;
    color: white;
    border: 2px solid red;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 0 12px red, 0 0 24px red;
    z-index: 9998;
    display: none;
    opacity: 0;
    transition: all 0.5s ease;
  }

  .continue-button:hover {
    transform: translateX(-50%) scale(1.05);
    box-shadow: 0 0 20px red, 0 0 40px red;
  }
</style>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scene 1</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Syne+Mono&display=swap" rel="stylesheet">
</head>

<body>
  <div class="center-box">
    <div class="scene-wrapper">
      <div class="scene-content" id="scene1">
        <h1 class="top-text">
          <span class="investigation-text">Investigation 1:</span>
          <span class="social-media-text">Eli's Social Media Feed</span>
        </h1>
        <div class="content-split">
          <div class="left-text">
            <div id="typewriter-text"></div>
            <p id="continuePrompt" class="continue-prompt">Press To Continue</p>
          </div>
          <div class="right-empty">
            <img src="eli-missing-poster-final.png?v=1" alt="Eli's Poster" class="right-image"
              onerror="this.style.display='none'; console.error('Image not found')" />
          </div>
        </div>
      </div>

      <div id="scene2" class="scene-content" style="display:none; opacity:0;">
        <h1 class="final-title">Decipher The Suspicious Posts</h1>
        <p class="final-subtitle">Click on all the posts that seem suspicious</p>
        <div class="instagram-grid" id="postGrid">
          <img src="post1.png" class="insta-post" data-id="1" onerror="this.style.display='none'">
          <img src="post2.png" class="insta-post" data-id="2" onerror="this.style.display='none'">
          <img src="post3.png" class="insta-post" data-id="3" onerror="this.style.display='none'">
          <img src="post4.png" class="insta-post" data-id="4" onerror="this.style.display='none'">
          <img src="post5.png" class="insta-post" data-id="5" onerror="this.style.display='none'">
          <img src="post6.png" class="insta-post" data-id="6" onerror="this.style.display='none'">
        </div>
      </div>
    </div>
    <button id="continueBtn" class="continue-button" style="display: none;">Continue</button>
  </div>

  <div id="toast" class="toast"></div>

  <audio id="clickSound" src="click.mp3" preload="auto"></audio>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const centerBox = document.querySelector('.center-box');
      centerBox.style.animation = 'fadeInOnly 1s ease-out forwards';
      const textElement = document.getElementById('typewriter-text');
      const continuePrompt = document.getElementById('continuePrompt');
      const clickSound = document.getElementById('clickSound');
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      let typeBuffer = null;

      const texts = [
        "Eli has mysteriously gone missing after a series of suspicious posts were shared on his social media feed...",
        "Authorities are scrambling to trace his digital footprint, but clues are vanishing as quickly as they appear.",
        "You've been tasked to dig deeper - to uncover the truth behind his disappearance and decode the feed."
      ];
      let currentIndex = 0;

      function typeWriterText(text, callback) {
        textElement.innerHTML = '';
        const paragraph = document.createElement('p');
        paragraph.style.margin = '0 0 1rem 0';
        const cursor = document.createElement('span');
        cursor.className = 'typewriter-cursor';
        paragraph.appendChild(cursor);
        textElement.appendChild(paragraph);

        let i = 0;
        const speed = 30;
        let source;

        if (typeBuffer) {
          source = audioContext.createBufferSource();
          source.buffer = typeBuffer;
          source.loop = true;
          source.connect(audioContext.destination);
          source.start();
        }

        function typeNextChar() {
          if (i < text.length) {
            const charSpan = document.createElement('span');
            charSpan.textContent = text.charAt(i);
            paragraph.insertBefore(charSpan, cursor);
            i++;
            setTimeout(typeNextChar, speed);
          } else {
            if (source) {
              source.stop();
              source.disconnect();
            }
            cursor.remove();
            if (callback) callback();
          }
        }

        typeNextChar();
      }

      function showNextText() {
        if (audioContext.state === 'suspended') {
          audioContext.resume();
        }

        if (currentIndex < texts.length) {
          continuePrompt.classList.remove('show');
          typeWriterText(texts[currentIndex], () => {
            continuePrompt.classList.add('show');
          });
          currentIndex++;
        } else {
          const scene1 = document.getElementById('scene1');
          const scene2 = document.getElementById('scene2');
          continuePrompt.classList.remove('show');
          scene1.classList.add('fade-out');

          setTimeout(() => {
            scene1.style.display = 'none';
            scene2.style.display = 'flex';
            scene2.style.opacity = '1';

            document.querySelectorAll('.insta-post').forEach(post => {
              post.addEventListener('click', () => {
                clickSound.currentTime = 0;
                clickSound.play().catch(() => {});

                const postId = post.getAttribute('data-id');
                const suspiciousIds = ['4', '5', '6'];
                const isSuspicious = suspiciousIds.includes(postId);

                post.classList.toggle('suspicious');
                showToast(isSuspicious
                  ? "✅ Good eye! This post is suspicious."
                  : "❌ Hmm... this one doesn't seem suspicious. Try again."
                );
              });
            });
          }, 1000);
        }
      }

      function showToast(message) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.add('toast-show');
        
        setTimeout(() => {
          toast.classList.remove('toast-show');
          
          // Check if all suspicious posts are selected AFTER toast fades
          const selected = Array.from(document.querySelectorAll('.insta-post.suspicious'))
                            .map(p => p.getAttribute('data-id'));
          const suspiciousIds = ['4', '5', '6'];
          const allFound = suspiciousIds.every(id => selected.includes(id));
          
          if (allFound) {
            const continueBtn = document.getElementById('continueBtn');
            continueBtn.style.display = 'inline-block';
            setTimeout(() => {
              continueBtn.style.opacity = '1';
            }, 10);
          }
        }, 2000); // Matches toast fade-out time
      }

      // Unlock audio on any user interaction
      document.body.addEventListener('click', () => {
        if (audioContext.state === 'suspended') {
          audioContext.resume();
        }
      }, { once: true });

      // Fetch and decode audio
      fetch('typewriter-audio-final.mp3')
        .then(response => response.arrayBuffer())
        .then(data => audioContext.decodeAudioData(data))
        .then(decoded => {
          typeBuffer = decoded;
          setTimeout(() => showNextText(), 100);
        })
        .catch(err => {
          console.warn("Audio preload failed", err);
          showNextText();
        });

      continuePrompt.addEventListener('click', showNextText);

      // Shuffle posts
      const postGrid = document.getElementById("postGrid");
      if (postGrid) {
        const posts = Array.from(postGrid.children);
        for (let i = posts.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [posts[i], posts[j]] = [posts[j], posts[i]];
        }
        posts.forEach(post => postGrid.appendChild(post));
      }
    });
  </script>
</body>
</html>
